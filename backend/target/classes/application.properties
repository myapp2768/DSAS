# 启用Spring MVC详细日志
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.web.servlet=DEBUG
logging.level.org.springframework.context=DEBUG
logging.level.com.dsas=DEBUG

# 显示所有注册的映射
logging.level.org.springframework.web.servlet.handler=TRACE

# 应用配置 - 生产级稳定性
server.port=8080
spring.application.name=DSAS
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=8192
server.tomcat.accept-count=100
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
server.tomcat.max-keep-alive-requests=100

# 确保DispatcherServlet映射到根路径
spring.mvc.servlet.path=/

# 禁用任何可能的重写规则
server.forward-headers-strategy=none

# 错误处理配置
server.error.include-stacktrace=never
server.error.include-message=never

# 增加Spring MVC的调试信息
logging.level.org.springframework.web.servlet.DispatcherServlet=DEBUG

# MySQL数据库配置（阿里云RDS）- 生产级稳定配置
spring.datasource.url=jdbc:mysql://rm-bp1r5ffxdyjm81z0pzo.mysql.rds.aliyuncs.com:3306/agriculture?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=10&initialTimeout=2
spring.datasource.username=jiangjian_2768
spring.datasource.password=Yhlz&276826
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP连接池配置 - 生产级稳定性优化
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=3
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.pool-name=DSAS-HikariCP
spring.datasource.hikari.register-mbeans=true

# JPA配置 - 生产级稳定性优化
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.current_session_context_class=org.springframework.orm.hibernate5.SpringSessionContext

# 事务管理配置
spring.jpa.properties.hibernate.transaction.coordinator_class=jdbc
spring.jpa.properties.hibernate.connection.handling_mode=delayed_acquisition_and_release_after_transaction

# 字符编码配置
spring.jpa.properties.hibernate.connection.characterEncoding=utf8
spring.jpa.properties.hibernate.connection.useUnicode=true

# 数据库连接健康检查
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always
management.health.db.enabled=true
management.health.diskspace.enabled=true